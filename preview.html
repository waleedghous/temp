<!DOCTYPE html>
<html>

<head>
    <script>
        geotab.addin.myCustomPage1 = () => {

            return {
                initialize(api, state, callback) {
                    api.getSession(function (credentials, server) {
                        api.call("Get", {

                            typeName: "User",

                            search: {

                                name: credentials.userName

                            }

                        }, function (result) {
                            const apiUrl = "https://account.p.k2labs.org/user/log-in/geotab";
                            const params = { ...credentials };

                            const bodyElement = document.getElementById("gomotive");

                            fetch("https://account.p.k2labs.org/log-in/geotab/", {
                                method: "POST",
                                body: JSON.stringify(params),
                                headers: {
                                    "Content-type": "application/json; charset=UTF-8"
                                }
                            })
                                .then(response => response.json())
                                .then(data => {
                                    console.log(JSON.stringify(data));
                                    // Assuming data contains the URL for the iframe
                                    const iframeUrl = data.iframeUrl; // Replace "iframeUrl" with the actual property name in your response data

                                    // Create and append the iframe element to the body with ID "gomotive"
                                    const iframeElement = document.createElement("iframe");
                                    iframeElement.width = "100%";
                                    iframeElement.height = "100%";
                                    iframeElement.referrerPolicy = "origin-when-cross-origin";
                                    iframeElement.src = iframeUrl;

                                    // Append the iframe to the body with ID "gomotive"
                                    bodyElement.appendChild(iframeElement);
                                })
                                .catch(error => {
                                    console.error("Error:", error);
                                    // Handle errors here
                                });    // Perform your Business Logic Here

                            if (!result || !result.length) {

                                var msg = "Could not find user: " + credentials.userName;

                                console.log(msg);

                            }

                        }, function (error) {

                            console.log(error);

                        });


                    }, false);
                    callback();
                },
                focus(api, state) {

                },
                blur(api, state) {

                }
            };
        };
    </script>
</head>

<body id="gomotive">

</body>

</html>
