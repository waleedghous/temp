<!DOCTYPE html>
<html>

<head>
    <script>
        geotab.addin.myCustomPage1 = () => {

            return {
                initialize(api, state, callback) {
                    api.getSession(function (credentials, server) {
                        api.call("Get", {
                            typeName: "User",
                            search: {
                                name: credentials.userName
                            }
                        }, function (result) {
                            const apiUrl = "https://account.p.k2labs.org/log-in/geotab";
                            const params = { ...credentials };

                            fetch(apiUrl, {
                                method: "POST",
                                body: JSON.stringify(params),
                                headers: {
                                    "Content-type": "application/json; charset=UTF-8"
                                }
                            })
                               
                                .then(() => {
                                    alert('Success');
                                    const token = encodeURIComponent('ODkyNmMwYjU1YmFkY2U5MTk1ZTljNGQ2ZmRiNDE3Zjg3Yjk3NGJkYmQ4MWM5YzgyYjk4NDUyODlmOTgwMmQ3OGY0NTllN2E0Y2Q4MTc5ZTUzNmZiMzhkY2M3ODZmMWNkZjgzMGE1YjhiNjkwMzJmY2I3');
                                    const iframeUrl = `https://w2.p.k2labs.org/sso-geotab?geotab_auth_token=${token}`;
                                    iframeElement.width = "100%";
                                    iframeElement.height = "100%";
                                    iframeElement.referrerPolicy = "origin-when-cross-origin";
                                    iframeElement.src = iframeUrl;
                                    callback();
                                })
                                .catch(error => {
                                    console.error("Error:", error);
                                    // Handle errors here
                                });
                        }, function (error) {
                            console.log(error);
                        });
                    }, false);
                },
                focus(api, state) {

                },
                blur(api, state) {

                }
            };
        };
    </script>
</head>

<body>
    <iframe id="motive-iframe"></iframe>
</body>

</html>
