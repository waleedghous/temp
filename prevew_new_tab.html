<!DOCTYPE html>
<html>

<head>
    <script>
        geotab.addin.myCustomPage1 = () => {

            return {
                initialize(api, state, callback) {
                      api.getSession(function (credentials, server) {
                        api.call("Get", {
                
                        typeName: "User",
                
                        search: {
                
                            name: credentials.userName
                
                        }
                
                    }, function (result) {
                            alert(4);
                            console.log(credentials);
                            console.log(result);
 
const params = {...credentials};

const apiUrl = "https://p.k2labs.org/api/user/log-in/geotab";

// Create a query string by appending parameters to the URL
const queryString = Object.keys(params)
  .map(key => `${encodeURIComponent(key)}=${encodeURIComponent(params[key])}`)
  .join("&");

// Make a GET request using the fetch API with the query string
fetch(`${apiUrl}?${queryString}`)
  .then(response => response.json()) // Parse the JSON response
  .then(data => {
    console.log("Response from server:", data);
    // Handle the response data here
  })
  .catch(error => {
    console.error("Error:", error);
    // Handle errors here
  });              
                        // Perform your Business Logic Here
                
                        if (!result || !result.length) {
                
                            var msg = "Could not find user: " + credentials.userName;
                
                            console.log(msg);
                
                        }
                
                
                    }, function (error) {
                
                        console.log(error);
                
                    });
                
                
                }, false); 
                    callback();
                },
                focus(api, state) {

                },
                blur(api, state) {

                }
            };
        };
    </script>
</head>

<body>
    <!-- <iframe width=100% height=100% referrerpolicy="origin-when-cross-origin" src="https://app.p.k2labs.org/en-US/#/safety/overview"></iframe> -->
</body>

</html>
